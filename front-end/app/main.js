define("text",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),define("social/social",[],function(){var e;return{init:function(t){return e=t,e.init()},invite:function(){e.invite()},showOrderBox:function(){return e.showOrderBox()},getUserUrl:function(t){return e.getUserUrl(t)},getUnknowImg:function(){return e.getUnknowImg()},wallPost:function(t){return e.wallPost(t)},getMe:function(){return e.getMe()},getPlayer:function(t){return e.getPlayer(t)},getPlayers:function(t){return e.getPlayers(t)},getFriends:function(){return e.getFriends()},getFriendsQty:function(){return e.getFriendsQty()},isUserInGroup:function(t){return e.isUserInGroup(t)},getCommunityHref:function(){return e.getCommunityHref()}}}),define("plugins/format",[],function(){return function(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,n){return typeof t[n]!="undefined"?t[n]:e})}}),define("social/demo",["jquery","plugins/format"],function(e,t,n){function o(e){return e.indexOf("http://cs")===-1?e.replace("http://","https://"):"https://pp.vk.me/c"+e.replace("http://cs","").replace(".vk.me","")}function u(e){return{id:e.uid||e.id,img:o(e.photo_50),name:e.first_name+" "+e.last_name}}var r="71627954",i={id:5653333,img:"https://pp.vk.me/c623220/v623220333/c060/4Np4xWzgxlU.jpg",name:"Anton Lapshin"},s=[{id:253300936,img:"https://pp.vk.me/c618421/v618421936/12aa1/RTXvKzOd65E.jpg",name:"Mikha Pogodin"},{id:229865556,img:"https://pp.vk.me/c306409/v306409233/3581/UAvmuA-GaBo.jpg",name:"Denis Shevchenko"},{id:159489458,img:"https://pp.vk.me/c6011/v6011165/464/9qbDEij68Uc.jpg",name:"Valentin Cherny"},{id:60981233,img:"https://pp.vk.me/c620823/v620823043/190fc/LJjNunV8d7c.jpg",name:"Anton Chaldaev"},{id:243782603,img:"https://pp.vk.me/c407822/v407822609/b820/bWlD4bP140g.jpg",name:"Andrey Moerchuk"},{id:5188175,img:"https://pp.vk.me/c616030/v616030119/17bb4/-Mf2RNRB04k.jpg",name:"Marsel Khakimov"},{id:5653333,img:"https://pp.vk.me/c619116/v619116629/17703/4Und2nzDjzI.jpg",name:"Anton Lapshin"},{id:233219052,img:"https://pp.vk.me/c619420/v619420700/b913/i5LtaPd0NCg.jpg",name:"Andriy Rozman"},{id:147936855,img:"https://pp.vk.me/c619116/v619116629/17703/4Und2nzDjzI.jpg",name:"Danik Boychuk"},{id:128954165,img:"https://pp.vk.me/c614726/v614726005/202ac/f9GMc_cX_CY.jpg",name:"Kristian Gitsba"},{id:191699661,img:"https://pp.vk.me/c319424/v319424721/df64/VjDpInEQtuM.jpg",name:"Pavel Taratynov"},{id:43065119,img:"https://pp.vk.me/c616030/v616030119/17bb4/-Mf2RNRB04k.jpg",name:"Marsel Khakimov"},{id:140340700,img:"https://pp.vk.me/c619420/v619420700/b913/i5LtaPd0NCg.jpg",name:"Andriy Rozman"},{id:169565629,img:"https://pp.vk.me/c619116/v619116629/17703/4Und2nzDjzI.jpg",name:"Danik Boychuk"}];return{init:function(){return e.Deferred(function(e){e.resolve()})},invite:function(){alert("showInviteBox")},showOrderBox:function(){return e.Deferred(function(e){window.setTimeout(e.resolve,500)})},getUserUrl:function(e){return"https://vk.com/id"+e},getUnknowImg:function(){return"//vk.com/images/deactivated_50.gif"},wallPost:function(t){return e.Deferred(function(e){alert("show Wall Post"),window.setTimeout(e.resolve,500)})},getMe:function(){return e.Deferred(function(e){e.resolve(i)})},getPlayer:function(t){return e.Deferred(function(n){n.resolve(e.grep(s,function(e){return e.id===t})[0])})},getPlayers:function(t){var n=e.grep([].concat(s),function(n){return e.inArray(n.id,t)!==-1});return e.Deferred(function(e){e.resolve(n)})},getFriends:function(){var t=[].concat(s),n=[t[0],t[1],t[2]];return e.Deferred(function(e){e.resolve(n)})},getFriendsQty:function(){return e.Deferred(function(e){e.resolve(3)})},isUserInGroup:function(t){return e.Deferred(function(e){VK.api("groups.isMember",{user_id:t,group_id:r},function(t){e.resolve(t.response.member===1)})})},getCommunityHref:function(){return"http://google.com/"}}}),define("plugins/localization",["ko"],function(e){var t,n={ru:0,en:1},r={decEnergy:["Затраты энергии","TBD"],earnMoney:["Заработано","TBD"],gymsBtnEnter:["Войти","Enter"],gym0name:["Качалка в подвале","Underground gym"],gym0desc:["Старый заброшенный подвал, переделанный под тренажерный зал. Здесь довольно сыро и совсем мало спортивного инвентаря.","TBD"],gym1name:["Зал 2","Gym 2"],gym1desc:["Тренажерный зал в школе","TBD"],gym2name:["Зал 3","Gym 3"],gym2desc:["Тренажерный зал","TBD"],ex0name:["Жим лёжа","Ex 1"],ex0desc:["Базовое упражнение","TBD"],ex1name:["Присед","Ex 2"],ex1desc:["Базовое упражнение","TBD"],ex2name:["Становая тяга","Ex 3"],ex2desc:["Базовое упражнение","TBD"],ex3name:["Тяга к поясу в наклоне","Ex 4"],ex3desc:["Упражнение Арнольда","TBD"],ex4name:["Подъемы на бицепс","Ex 5"],ex4desc:["Бицуха","TBD"],ach0name:["Новичок","TBD"],ach0desc:["Выполнил первую тренировку до полной усталости","TBD"],ach1name:["Сбор штанги","TBD"],ach1desc:["Подтвердил умение собирать вес для штанги","TBD"],ach2name:["Жим лежа 80 кг","TBD"],ach2desc:["Установлен личный рекорд 80 кг в жиме лежа","TBD"],achNew:["Новое достижение","TBD"],trChooseWeight:["Выберите вес","Choose the weight"],trChooseRepeats:["Количество повторений","Number of repeats"],trMeasureWeight:["кг","kg"],trNoLimit:["до отказа","no limit"],trExecute:["Выполнить","Execute"],menuHome:["Домой","Home"],menuWorkout:["Тренировка","Workout"],menuRest:["Отдых","Rest"],menuAchievements:["Достижения","Achievements"],menuShop:["Магазин","Shop"],menuJob:["Работа","Job"],jobTitle:["Работа","Job"],jobAsk:["Необходимо собрать штангу весом {0} кг. Вес грифа составляет 20кг. Вы готовы?","TBD"],jobTimeIsUp:["Время вышло","Time is up"],jobWrongWeight:["Вес превышен","Wrong weight"],jobSuccess:["Вес собран","Success"],jobStatus:["Собрано: {0}кг. Нужно собрать: {1}кг","TBD"],YES:["Да","Yes"],NO:["Нет","No"],bankMoney:["Не хватает денег? Нажми, чтобы пополнить счет.","TBD"],bankEnergy:["Нажми, чтобы восстановить силы.","TBD"],bankGold:["Купить золото.","TBD"],socialFriends:["Нажми, чтобы пригласить в игру друзей.","TBD"],massAdd:["Не хватает массы? Нажми и мы придумаем как тебе помочь","TBD"],massUnit:["кг","kg"],showFrazzle:["Показать усталость","Show frazzle"],manFrazzle:["Усталость","Frazzle"],manStress:["Стресс","Stress"],manM0:["Мышцы шеи","TBD"],manM1:["Трапециевидные мышцы","TBD"],manM2:["Дельтовидные мышцы","TBD"],manM3:["Бицепс","TBD"],manM4:["Трицепс","TBD"],manM5:["Мышцы предплечья","TBD"],manM6:["Грудные мышцы","TBD"],manM7:["Косые мышцы живота","TBD"],manM8:["Прямые мышцы живота","TBD"],manM9:["Круглые мышцы","TBD"],manM10:["Широчайшие мышцы","TBD"],manM11:["Ягодичные мышцы","TBD"],manM12:["Задние мышцы бедра","TBD"],manM13:["Квадрицепс","TBD"],manM14:["Большеберцовые мышцы","TBD"],manM15:["Икроножные мышцы","TBD"],manFr0:["Усталости нет","TBD"],manFr1:["Небольшая усталость","TBD"],manFr2:["Средняя усталость","TBD"],manFr3:["Сильная усталость","TBD"],manFr4:["Очень сильная усталость","TBD"],journalHeader:["Журнал тренировки","TBD"],mesWorldRecord:["Новый абсолютный рекорд!","TBD"],mesPresonalRecord:["Новый персональный рекорд!","TBD"],mesWorldRecordDesc:["Вы установили новый абсолютный рекорд, выполнив упражнение {0} с весом <b>{1}кг</b>","TBD"],mesPersonalRecordDesc:["Вы установили новый персональный рекорд, выполнив упражнение {0} с весом <b>{1}кг.</b>","TBD"],wr:["Абсолютный рекорд","Absolute Record"],pr:["Персональный рекорд","Personal Record"],wrDesc:["Будет установлен абсолютный рекорд","TBD"],prDesc:["Будет установлен персональный рекорд","TBD"],wrMini:["АР","AR"],prMini:["ПР","PR"],wrNone:["не установлен","none"],topPlayers:["Топ игроков","Top Players"],topFriends:["Топ друзей","Top Friends"],buy:["Купить","Buy"]},i={getLanguage:function(){return t},setLanguage:function(i){t=i;for(var s in r){if(!r.hasOwnProperty(s))continue;this[s]?this[s](r[s][n[t]]):this[s]=e.observable(r[s][n[t]])}}};return i.setLanguage(window.cfg.language),i}),define("c",["ko","jquery","plugins/localization","plugins/format"],function(e,t,n,r){function o(e,t){return Math.random()*(t-e)+e|0}function u(e,t){return typeof e=="string"?t+"+"+e:t+"+"+(e?(typeof e.name=="function"?e.name():e.name)||"default":"default")}function a(n,r,i){var o=typeof r=="function"?this:r;return o.name=n,o.model=e.observable(null),o.isVisible=e.observable(!1),o.show=function(){return o.isVisible(!0),o.onShow&&o.onShow(),o},o.hide=function(){return o.isVisible(!1),o},o.set=function(e){return o.model(e),o},o.update=function(){return o},o.init=function(){return o},o.load=function(e){o.onLoad&&o.onLoad(t(e))},s[n]=o,typeof r=="function"&&(r.call(this,n),i&&i.model&&o.init().set(i.model).show()),o}function f(e,t,n){var r=u(e,t);return s[r]?(e&&e.model&&typeof n=="function"&&s[r].set&&s[r].set(e.model),s[r]):new a(r,n,e)}var i={},s={},l={random:o,format:r,strings:n,viewModels:s,add:function(t,n,r){var i={viewModel:function(e){return f(e,r,t)},template:n};return e.components.isRegistered(r)||e.components.register(r,i),i.viewModel},on:function(e,t){i.hasOwnProperty(e)||(i[e]=[]),i[e].push(t)},fire:function(e,n){i.hasOwnProperty(e)&&t.each(i[e],function(e,t){t(n)})}};return e.c=l,e.c.on("component.loaded",function(t){e.applyBindingsToNode(t.elem,{visible:t.vm.isVisible},t.vm),t.vm.load(t.elem)}),l}),define("server/server",["jquery","c"],function(e,t){var n,r={loadTop:{lastDateTime:0,data:null,timeout:3e5},loadRefs:{lastDateTime:0,data:null,timeout:36e5},loadMe:{lastDateTime:0,data:null,timeout:5e3}};return{proxy:function(){var i=[].shift.apply(arguments),s=arguments;return e.Deferred(function(e){if(r[i]&&Date.now()-r[i].lastDateTime<=r[i].timeout){e.resolve(r[i].data);return}n[i].apply(n,s).then(function(n){r[i]&&(r[i].lastDateTime=Date.now(),r[i].data=n),t.fire("server.response",n),e.resolve(n)})})},init:function(e,t,r){return n=e,e.init(t,r)},loadRefs:function(){return this.proxy("loadRefs")},loadMe:function(e){return this.proxy("loadMe",e)},loadPlayer:function(e){return this.proxy("loadPlayer",e)},loadPlayers:function(e){return this.proxy("loadPlayers",e)},loadTop:function(){return this.proxy("loadTop")},update:function(e){return this.proxy("update",e)},gymExecute:function(e){return this.proxy("gymExecute",e)},jobGet:function(){return this.proxy("jobGet")},jobComplete:function(){return this.proxy("jobComplete")}}}),define("plugins/ajax",["jquery"],function(e){function i(e,r){var i=t+e+"?";if(r!=null)for(var s in r)i=i+s+"="+r[s]+"&";return i+=n,i}var t=window.cfg.server,n="callback=?",r=5e4;return{callAjax:function(t,n){return e.Deferred(function(s){e.ajax({url:i(t,n),type:"GET",dataType:"json",timeout:r}).then(function(e){e=JSON.parse(e),window.cfg.debug&&console.log(e);if(e.error){s.reject(e.error);return}s.resolve(e.data)})})}}}),define("server/heroku",["jquery","plugins/ajax"],function(e,t){return{init:function(e,n){return t.callAjax("auth",{playerId:e,authKey:n})},loadRefs:function(){return t.callAjax("refs")},loadMe:function(e){return t.callAjax("self",{method:"get"})},update:function(e){return t.callAjax("self",{method:"update",friends:e})},loadTop:function(){return t.callAjax("top",null)},gymExecute:function(e){return e.method="execute",t.callAjax("gym",e)}}}),define("model/player",["ko","server/server","social/social"],function(e,t,n){function r(e,t){return $.each(e,function(e,n){var r=$.grep(t,function(e){return n._id==e.id})[0];$.extend(n.public,r)}),e}function i(){return n.getMe().then(function(e){return $.Deferred(function(n){t.loadMe(e.id).then(function(t){n.resolve(r([t],[e])[0])})})})}function s(e){return n.getPlayer(e).then(function(e){return $.Deferred(function(n){t.loadPlayer(e.id).then(function(t){n.resolve(r([t],[e])[0])})})})}function o(e,t){if(!t)return;var n=e()||0;if(n===t)return;var r=n+(t>n?1:-1);e(r);var i=Math.abs(t-r)>50?1:Math.pow(Math.min(t,r)/Math.max(t,r),2)*50;setTimeout(function(){o(e,t)},i)}function u(t,n){n=n||this,n._id=t,n.public={level:e.observable(),name:null,img:null,mass:e.observable(),exercises:[]},n.loadPublic=function(e){n._id=e._id,n.public.level(e.public.level),n.public.name=e.public.name,n.public.img=e.public.img,n.public.mass(e.public.level*10),n.public.exercises=e.public.exercises},n.load=function(){return s(t).then(n.loadPublic)}}function a(){var r=this;u(null,this),this.private={money:e.observable(),gold:e.observable(),energy:e.observable(),friends:e.observable(),energyMax:e.observable(),gyms:[],achievements:[],body:[]};for(var s=0;s<16;s++)this.private.body.push({_id:s,stress:e.observable(0),frazzle:e.observable(0)});this.load=function(){return i().then(function(e){r.loadPublic(e),o(r.private.money,e.private.money),o(r.private.energy,e.private.energy),o(r.private.gold,e.private.gold),o(r.private.friends,e.private.friends),r.private.energyMax(e.private.energyMax),r.private.gyms=e.private.gyms,r.private.achievements=e.private.achievements,$.each(e.private.body,function(e,t){r.private.body[e].stress(t.stress),r.private.body[e].frazzle(t.frazzle)}),n.getFriendsQty().then(function(n){n!==e.private.friends&&(o(r.private.friends,e.private.friends),t.update(n))})})},this.updateValue=o}function f(e){return e?new u(e):new a}return f}),define("model/refs",["jquery","server/server","c"],function(e,t,n){function s(t,s){var o=e.grep(r.muscles,function(e){return e._id===t._id})[0],u=s?e.grep(i.private.body,function(e){return e._id===t._id})[0]:{},a=e.map(t.map.split(","),function(e,t){return t%2==0?e-50:e}).join(",");return e.extend({map:a},o,u,{name:n.strings[n.format("manM{0}",t._id)]})}function o(t){var s=e.grep(i.public.exercises,function(e){return e._id===t}),o=s.length>0;return e.extend({name:n.strings[n.format("ex{0}name",t)],desc:n.strings[n.format("ex{0}desc",t)],img:n.format("components/workout/ex{0}.jpg",t),disabled:!o},o?s[0]:{},r.exercises[t])}function u(t){var s=!1,o=r.gyms[t];if(i.private.gyms.indexOf(t)!==-1)s=!0;else{var u=o.conditions;e.each(u,function(e,t){if(i.public.level>=t.level&&i.private.friends>=t.friends)return s=!0,!1})}return e.extend({name:n.strings[n.format("gym{0}name",t)],desc:n.strings[n.format("gym{0}desc",t)],img:n.format("components/gyms/gym{0}.jpg",t),disabled:!s},r.gyms[t])}function a(t){var s=i.private.achievements.indexOf(t)!==-1;return e.extend({name:n.strings[n.format("ach{0}name",t)],desc:n.strings[n.format("ach{0}desc",t)],completed:s},r.achievements[t])}var r,i;return{load:function(n){var s=this;return t.loadRefs().then(function(t){r=t,i=n,e.extend(s,t)})},getMuscles:function(t){var n=e.grep(r.muscles_view,function(e){return e._id==i.public.level()})[0].front;return e.map(n,function(e){return s(e,t)})},getExercise:o,getExercises:function(t){return e.map(r.gyms[t].exercises,function(e){return o(e)})},getGyms:function(){return e.map(r.gyms,function(e){return u(e._id)})},getAchievements:function(){return e.map(r.achievements,function(e){return a(e._id)})}}}),define("model/game",["jquery","bootbox","toastr","model/player","model/refs","c"],function(e,t,n,r,i,s){return{player:null,error:function(e){t.alert(e)},init:function(){var o=this;return this.player=new r,t.setDefaults({backdrop:!0,onEscape:!0}),n.options={closeButton:!1,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-bottom-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},s.on("energy.decrease",function(e){n.warning("-"+e+'<span class="glyphicon glyphicon-flash"></span>',s.strings.decEnergy()),o.player.updateValue(o.player.private.energy,o.player.private.energy()-3)}),s.on("record",function(t){var r=i.getExercise(t.exerciseId).name(),u=t.weight,a=t.result.record==="WR"?s.strings.mesWorldRecord():s.strings.mesPresonalRecord(),f=t.result.record==="WR"?s.strings.mesWorldRecordDesc():s.strings.mesPersonalRecordDesc();f=s.format(f,r,u),t.result.record==="WR"?e.grep(i.exercises,function(e){return e._id===t.exerciseId})[0].wr={_id:o.player._id,value:u}:e.grep(o.player.public.exercises,function(e){return e._id===t.exerciseId})[0].pr=u,n.success(f,a)}),s.on("money.earn",function(e){n.success("+"+e+'<span class="glyphicon glyphicon-usd"></span>',s.strings.earnMoney()),o.player.updateValue(o.player.private.money,o.player.private.money()+e)}),s.on("server.response",function(e){if(e.achievement){var t=e.achievement._id,r=i.getAchievements()[t];n.success(r.name(),s.strings.achNew()),o.player.private.achievements.push(t),s.fire("achievements.update")}}),e.when.apply(this,[this.player.load(),i.load(this.player)])}}}),define("plugins/dynamic-tooltips",["jquery"],function(e){e("body").on("DOMNodeInserted",'[data-toggle="tooltip"]',function(t){window.setTimeout(function(){e(t.target).tooltip()},0)})}),define("plugins/prevent-selection",["jquery"],function(e){e("*").on("selectstart",function(){return!1})}),define("plugins/ko-hack",["ko"],function(e){function n(t,n,r){var i=n.template;if(!i)throw new Error("Component '"+t+"' has no template");var s=e.utils.cloneNodes(i);e.virtualElements.setDomNodeChildren(r,s)}function r(e,t,n,r){var i=e.createViewModel;return i?i.call(e,r,{element:t,templateNodes:n}):r}var t=0;e.bindingHandlers.component={init:function(i,s,o,u,a){var f,l,c=function(){var e=f&&f.dispose;typeof e=="function"&&e.call(f),l=null},h=e.utils.makeArray(e.virtualElements.childNodes(i));return e.utils.domNodeDisposal.addDisposeCallback(i,c),e.computed(function(){var o=e.utils.unwrapObservable(s()),u,p;typeof o=="string"?u=o:(u=e.utils.unwrapObservable(o.name),p=e.utils.unwrapObservable(o.params));if(!u)throw new Error("No component name specified");var d=l=++t;e.components.get(u,function(t){if(l!==d)return;c();if(!t)throw new Error("Unknown component '"+u+"'");n(u,t,i);var s=r(t,i,h,p),o=a.createChildContext(s,undefined,function(e){e.$component=s,e.$componentTemplateNodes=h});f=s,e.applyBindingsToDescendants(o,i),e.c.fire("component.loaded",{elem:i,vm:o.$rawData})})},null,{disposeWhenNodeIsRemoved:i}),{controlsDescendantBindings:!0}}},e.virtualElements.allowedBindings.component=!0}),define("text!cs/main/view.html",[],function(){return'<div class="main">\r\n    <private params="name: \'main\'"></private>\r\n    <menu params="name: \'main\'"></menu>\r\n    <div class="menu-container">\r\n        <man params="name: \'main\'"></man>\r\n        <job params="name: \'main\'"></job>\r\n        <gyms params="name: \'main\'"></gyms>\r\n        <workout params="name: \'main\'"></workout>\r\n        <achievements params="name: \'main\'"></achievements>\r\n    </div>\r\n    <top params="name: \'main\'"></top>\r\n</div>'}),define("text!cs/private/view.html",[],function(){return'<div class="private">\r\n    <img src="components/private/logo.png"/>\r\n    <div class="bricks"></div>\r\n    <div class="info info-ava">\r\n        <ava params="name: \'private\'"></ava>\r\n        <battery params="name: \'private\'"></battery>\r\n    </div>\r\n    <div class="info info-money">\r\n        <money params="name: \'private\'"></money>\r\n        <mass params="name: \'private\'"></mass>\r\n        <friends params="name: \'private\'"></friends>\r\n        <gold params="name: \'private\'"></gold>\r\n    </div>\r\n</div>'}),define("text!cs/ava/view.html",[],function(){return'<div class="ava" data-bind="click:click">\r\n    <!-- ko if: model() -->\r\n    <img class="avatar" alt="" src="" data-bind="attr: { src: model().public.img }"/>\r\n    <img class="frame" alt="" src="components/ava/frame.png" data-bind="attr: { title: model() ? model().public.name : \'\' }"\r\n         data-toggle="tooltip" data-placement="left"/>\r\n    <!-- /ko -->\r\n</div>'}),define("cs/ava/vm",["ko","text!./view.html","c","social/social"],function(e,t,n,r){function i(){this.click=function(){if(this.model().private){n.fire("player.click",this.model()._id);return}if(this.model()._id==0){r.invite();return}var e=r.getUserUrl(this.model()._id),t=window.open(e,"_blank");t.focus()},this.onLoaded=function(e){setTimeout(function(){e.find("img.frame").tooltip()},1e3)},this.test=function(){var e=this;require(["model/game"],function(t){e.init().set(t.player).show()})}}return n.add(i,t,"ava")}),define("text!cs/battery/view.html",[],function(){return'<div class="battery" data-bind="click:click,attr:{\'title\':title}"\r\n           data-toggle="tooltip" data-placement="bottom">\r\n    <!-- ko if: value != undefined -->\r\n    <div class="progress">\r\n        <div class="progress-bar" role="progressbar"\r\n             aria-valuemin="0"\r\n             data-bind="attr:{\'aria-valuenow\':value,\'aria-valuemax\':max},style:{width:percent()},\r\ncss:{\'progress-bar-success\':yellow() <= value(),\'progress-bar-warning\':red() <= value() && value() < yellow(),\'progress-bar-danger\':value() < red()}">\r\n        </div>\r\n    </div>\r\n    <div class="value text-center" data-bind="text: valueDesc"></div>\r\n    <!-- /ko -->\r\n</div>'}),define("cs/battery/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){var t=this;this.red=e.observable(),this.yellow=e.observable(),this.title=n.strings.bankEnergy,this.value=null,this.set=function(n,r,i){return this.max=n,this.value=r,this.percent=e.computed(function(){return this.value()/this.max()*100+"%"},this),this.red=e.computed(function(){return this.max()*.33},this),this.yellow=e.computed(function(){return this.max()*.66},this),this.valueDesc=e.computed(function(){return i==="%"?this.value()/this.max()*100+"%":this.value()+"/"+this.max()},this),t},this.click=function(){n.fire("energy.add")},this.test=function(){function i(){n(r),r<t()&&window.setTimeout(i,20),r++}var t=e.observable(155),n=e.observable(115);this.init().set(t,n).show();var r=0;window.setTimeout(i,1e3)}}return n.add(r,t,"battery")}),define("text!cs/mass/view.html",[],function(){return'<div class="mass well well-sm" title="Вес" data-bind="visible: isVisible,click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span>\r\n    <span data-bind="text: model()"></span>\r\n    <span data-bind="text: unit"></span>\r\n</div>'}),define("cs/mass/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.massAdd,this.unit=n.strings.massUnit,this.test=function(){var t=e.observable(10);this.show(t),t(82.5)},this.click=function(){alert("add mass")}}return n.add(r,t,"mass")}),define("text!cs/money/view.html",[],function(){return'<div class="money label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-usd" aria-hidden="true"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("cs/money/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.bankMoney,this.click=function(){n.fire("money.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(200)}}return n.add(r,t,"money")}),define("text!cs/gold/view.html",[],function(){return'<div class="gold label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-certificate"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("cs/gold/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.bankGold,this.click=function(){n.fire("gold.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(15)}}return n.add(r,t,"gold")}),define("text!cs/friends/view.html",[],function(){return'<div class="friends label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-user"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("cs/friends/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.socialFriends,this.click=function(){n.fire("friends.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(5)}}return n.add(r,t,"friends")}),define("cs/private/vm",["ko","text!./view.html","c","cs/ava/vm","cs/battery/vm","cs/mass/vm","cs/money/vm","cs/gold/vm","cs/friends/vm"],function(e,t,n,r,i,s,o,u,a){function f(){var e=this;this.init=function(){return r("private").init().show(),i("private").init().show(),s("private").init().show(),o("private").init().show(),u("private").init().show(),a("private").init().show(),a("private").init().show(),e},this.set=function(t){return r("private").set(t),i("private").set(t.private.energyMax,t.private.energy),s("private").set(t.public.mass),o("private").set(t.private.money),u("private").set(t.private.gold),a("private").set(t.private.friends),e},this.test=function(){require(["model/game"],function(t){e.init().set(t.player).show()})}}return n.add(f,t,"private")}),define("text!cs/menu/view.html",[],function(){return'<div class="menu">\r\n    <ul class="nav nav-pills" data-bind="foreach: items">\r\n        <li role="presentation" data-bind="css: {active:active}, click: $parent.select">\r\n            <a href="#" data-bind="text:name"></a>\r\n        </li>\r\n    </ul>\r\n</div>'}),define("cs/menu/vm",["ko","text!./view.html","c"],function(e,t,n){function s(){var t=this;this.items=e.observableArray(i),this.selectByIndex=function(e){i.forEach(function(e){e.active(!1)}),e>=0&&(i[e].active(!0),n.fire("menu.select",e))},this.select=function(){var e=t.items().indexOf(this);t.selectByIndex(e)},this.test=function(){n.on("menu.select",function(e){console.log("Selected item is "+e)}),this.init().show()}}var r=n.strings,i=[{name:r.menuHome,active:e.observable(!0)},{name:r.menuJob,active:e.observable(!1)},{name:r.menuWorkout,active:e.observable(!1)},{name:r.menuAchievements,active:e.observable(!1)},{name:r.menuShop,active:e.observable(!1)}];return n.add(s,t,"menu")}),define("text!cs/man/view.html",[],function(){return'<div class="man">\r\n\r\n    <img class="img-back" src="components/gyms/gym0.jpg"/>\r\n\r\n    <div class="shadow"></div>\r\n\r\n    <!-- ko if: model() -->\r\n\r\n    <map name="navigation" data-bind="foreach: muscles">\r\n        <area data-bind="attr: { coords: map, \'data-id\': $index }"\r\n              shape="poly"\r\n              href="javascript:;">\r\n    </map>\r\n\r\n    <img class="img-body" alt="" src="" data-bind="attr: { src: src }"/>\r\n\r\n    <muscleinfo params="name: \'man\'"></muscleinfo>\r\n\r\n    <img class="img-map" src="components/man/transparent.png" border="0" usemap="#navigation"/>\r\n\r\n    <ava params="name:\'man\'"></ava>\r\n\r\n    <div class="frazzle-map" data-bind="visible: model().private">\r\n        <h5 data-bind="text: strings.showFrazzle"></h5>\r\n        <sw params="name: \'man\'"></sw>\r\n    </div>\r\n\r\n    <!-- /ko -->\r\n\r\n</div>'}),define("text!cs/muscleinfo/view.html",[],function(){return'<div class="muscleinfo">\r\n    <!-- ko if: model -->\r\n    <div class="info">\r\n        <h4 data-bind="text: strings[\'manM\' + model()._id]"></h4>\r\n        <battery params="name: \'muscleinfo\'"></battery>\r\n    </div>\r\n    <svg>\r\n        <line x2="500" y2="70" stroke-width="1" stroke="rgba(255, 255, 255, 0.37)" data-bind="attr: { x1: model().x1, y1: model().y1 }"/>\r\n        <circle r="2" fill="rgba(255, 255, 255, 0.37)" data-bind="attr: { cx: model().x1, cy: model().y1 }"/>\r\n        <circle cx="500" cy="70" r="2" fill="rgba(255, 255, 255, 0.37)"/>\r\n    </svg>\r\n    <!-- /ko -->\r\n</div>'}),define("cs/muscleinfo/vm",["ko","jquery","text!./view.html","c","cs/battery/vm"],function(e,t,n,r,i){function s(){var n=this;this.strings=r.strings,this.init=function(){return i("muscleinfo").init().show(),n},this.set=function(t){this.model(t);if(t.frazzle){var r=i("muscleinfo"),s=Math.floor(100-t.frazzle()*100);if(!r.value){var o=e.observable(100),u=e.observable(s);r.set(o,u,"%")}else r.value(s)}return n},this.test=function(){var n={_id:3,frazzle:e.observable(.5),stress:e.observable(.2),x1:50,y1:50};this.init().set(n).show(),t("body").css("background-color","black")}}return r.add(s,n,"muscleinfo")}),define("text!cs/sw/view.html",[],function(){return'<div class="sw text-center">\r\n    <input type="checkbox"/>\r\n    <label class="attention" data-bind="event: { mousedown: click }">\r\n        <i></i>\r\n    </label>\r\n</div>'}),define("cs/sw/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){var e=this;this.state=!1,this.click=function(t){$(t.click.arguments[1].currentTarget).prev("input").click(),e.state=!e.state,n.fire("sw.switch",{name:e.name,state:e.state})},this.test=function(){n.on("sw.switch",function(e){console.log(e)}),this.init().show()}}return n.add(r,t,"sw")}),define("cs/man/vm",["ko","jquery","text!./view.html","c","social/social","model/refs","model/player","cs/muscleinfo/vm","cs/sw/vm","cs/ava/vm"],function(e,t,n,r,i,s,o,u,a,f){function l(e){e.frazzle$=t('<canvas class="frazzle" width="480px" height="550px"/>'),e.elem$.find("img.img-map").before(e.frazzle$);var n=e.frazzle$[0].getContext("2d");t.each(e.muscles(),function(e,t){var i=t.map.split(",");n.beginPath(),n.moveTo(i[0],i[1]);for(var s=2;s<i.length-1;s+=2)n.lineTo(i[s],i[s+1]);n.closePath(),n.fillStyle=r.format("rgba(255,0,0,{0})",t.frazzle()/2),n.fill()})}function c(e){e.frazzle$.remove()}function h(e,n){e.highlight$=t('<canvas class="highlight" width="480px" height="550px"/>'),e.elem$.find("img.img-map").before(e.highlight$);var r=e.highlight$[0].getContext("2d"),i=n.map.split(",");r.beginPath(),r.moveTo(i[0],i[1]);for(var s=2;s<i.length-1;s+=2)r.lineTo(i[s],i[s+1]);r.closePath(),r.fillStyle="rgba(0,255,0,.4)",r.fill()}function p(e){e.highlight$.remove()}function d(){var n=this;this.strings=r.strings,this.src=e.observable(),this.muscles=e.observableArray(),this.click=function(){if(this.model().id==0){i.invite();return}var e=i.getUserUrl(this.model().id),t=window.open(e,"_blank");t.focus()},this.init=function(){return f("man").init(),a("man").init(),u("man").init(),r.on("sw.switch",function(e){if(e.name!=="sw+man")return;e.state?l(n):c(n)}),n},this.set=function(e){return this.model(e),this.src(r.format("components/man/{0}.png",e.public.level())),this.muscles(s.getMuscles(!!e.private)),e.private?(f("man").hide(),a("man").show()):f("man").set(e).show(),n},this.onLoad=function(e){e.on("mouseenter","area",function(e){var r=t(e.currentTarget).data("id"),i=n.muscles()[r];h(n,i)}),e.on("mousemove","area",function(e){var r=t(e.currentTarget).data("id"),i=n.muscles()[r],s=n.elem$.offset();i.x1=e.clientX-s.left,i.y1=e.clientY-s.top,u("man").set(i).show()}),e.on("mouseleave","area",function(){u("man").hide(),p(n)}),this.elem$=e},this.test=function(){require(["model/game"],function(e){n.init().set(e.player).show()})}}return r.add(d,n,"man")}),define("text!cs/job/view.html",[],function(){return'<div class="job" data-bind="loaded: true">\r\n    <!-- ko if: weight() -->\r\n    <div class="summary-weight" data-bind="text: textStatus">\r\n    </div>\r\n\r\n    <ul class="area-left" data-bind="foreach: itemsLeft">\r\n        <li data-bind="attr:{title:header},style:{ left:x,top:y},click:function(){$parent.select($data);}"\r\n            class="disc" data-toggle="tooltip" data-placement="right">\r\n            <img data-bind="attr: { src: img }, style: {\'transform\': \'rotate(\' + deg + \'deg)\'}"/>\r\n        </li>\r\n    </ul>\r\n    <ul class="area-right" data-bind="foreach: itemsRight">\r\n        <li data-bind="attr:{title:header},style:{ left:x,top:y},click:function(){$parent.select($data);}"\r\n            class="disc" data-toggle="tooltip" data-placement="right">\r\n            <img data-bind="attr: { src: img }, style: {\'transform\': \'rotate(\' + deg + \'deg)\'}"/>\r\n        </li>\r\n    </ul>\r\n    <ul class="side-left" data-bind="foreach: itemsSideLeft">\r\n        <li class="disc" data-bind="attr: { title: header, }, style: { left: x, top: y }"\r\n            data-toggle="tooltip" data-placement="right">\r\n            <img data-bind="attr: { src: img }"/>\r\n        </li>\r\n    </ul>\r\n    <ul class="side-right" data-bind="foreach: itemsSideRight">\r\n        <li class="disc" data-bind="attr: { title: header }, style: { left: x, top: y }"\r\n            data-toggle="tooltip" data-placement="right">\r\n            <img data-bind="attr: { src: img }"/>\r\n        </li>\r\n    </ul>\r\n\r\n    <timer params="name:\'job\'"></timer>\r\n    <!-- /ko -->\r\n</div>'}),define("text!cs/timer/view.html",[],function(){return'<div class="timer" data-bind="text: value">\r\n</div>'}),define("cs/timer/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){var t=this;this.value=e.observable(""),this.interval=null,this.seconds=null,this.setValue=function(){var e=Math.floor(t.seconds/60),n=Math.floor(t.seconds%60);n<10&&(n="0"+n),this.value(e+":"+n)},this.start=function(e){return this.stop(),this.seconds=e,this.setValue(),this.interval=setInterval(function(){t.seconds--,t.setValue(),t.seconds===0&&(n.fire("timer.stop",t.name),t.stop())},1e3),t},this.stop=function(){t.hide(),clearInterval(t.interval)},this.test=function(){n.on("timer.stop",function(){console.log("finished")}),this.init().start(2).show()}}return n.add(r,t,"timer")}),define("cs/job/vm",["ko","jquery","text!./view.html","c","cs/timer/vm","server/server","bootbox"],function(e,t,n,r,i,s,o){function v(e){var n,i=[].concat(d).sort(function(){return.5-Math.random()}),s=0,o=0,u=0;return t.map(i,function(t){var n=p[t],i=r.random(2,15);s+n.size+i>c.width&&(s=r.random(0,15),o=o+128+r.random(0,15));if(o+n.size>c.height)return null;var u={weight:n.weight,id:t,x:s,y:o,side:e,deg:r.random(0,360)};return s=s+n.size+i,u})}function m(e,t){var n=[];for(var i=0;i<e.length;i++){var s=e[i];if(s.side==t)continue;var o=p[s.id],u={id:s.id,weight:o.weight,header:o.header+r.strings.massUnit(),img:a+o.img+".png",x:s.x+"px",y:s.y+"px",deg:s.deg};n.push(u)}return n}function g(){var t=this;this.weight=e.observable(),this.items=e.observableArray([]),this.itemsSelected=e.observableArray([]),this.summaryWeight=e.computed(function(){var e=h;for(var t=0;t<this.itemsSelected().length;t++)e+=this.itemsSelected()[t].weight;return e},this),this.textStatus=e.computed(function(){return r.format(r.strings.jobStatus(),this.summaryWeight(),this.weight())},this),this.itemsLeft=e.computed(function(){return m(this.items(),"right")},this),this.itemsRight=e.computed(function(){return m(this.items(),"left")},this),this.itemsSideLeft=e.computed(function(){var e=[],t=f.x,n=f.y;for(var i=0;i<this.itemsSelected().length;i++){var s=this.itemsSelected()[i];if(s.side=="right")continue;var o=p[s.id];t-=o.width;var u={header:o.header+r.strings.massUnit(),img:a+o.img+"-side.png",x:t+"px",y:Math.floor(n-o.size/2)+"px"};e.push(u)}return e},this),this.itemsSideRight=e.computed(function(){var e=[],t=l.x,n=l.y;for(var i=0;i<this.itemsSelected().length;i++){var s=this.itemsSelected()[i];if(s.side=="left")continue;var o=p[s.id],u={header:o.header+r.strings.massUnit(),img:a+o.img+"-side.png",x:t+"px",y:Math.floor(n-o.size/2)+"px"};t+=o.width,e.push(u)}return e},this),this.onShow=function(){this.reset()},this.init=function(){return i("job").init(),r.on("timer.stop",function(){o.dialog({message:r.strings.jobTimeIsUp(),title:r.strings.jobTitle()}),r.fire("home")}),t},this.reset=function(){i("job").hide(),t.itemsSelected([]),t.items([]),t.weight(null)},this.start=function(){return s.jobGet().then(function(e){o.dialog({message:r.format(r.strings.jobAsk(),e),title:r.strings.jobTitle(),buttons:{yes:{label:r.strings.YES(),className:"btn-success",callback:function(){t.itemsSelected([]);var n=v("left"),r=v("right"),s=[],o;for(o=0;o<n.length;o++)s.push(n[o]);for(o=0;o<r.length;o++)s.push(r[o]);t.items(s),t.weight(e),i("job").start(u).show()}},no:{label:r.strings.NO(),className:"btn-danger",callback:function(){}}}})}),t},this.select=function(e){var t=p[e.id],n=this.itemsSelected(),u=this.items(),a=[];for(var f=0;f<u.length;f++)u[f].weight!=t.weight?a.push(u[f]):n.push(u[f]);this.items(a),this.itemsSelected(n),this.summaryWeight()==this.weight()?s.jobComplete().then(function(e){o.dialog({message:r.strings.jobSuccess(),title:r.strings.jobTitle()}),i("job").stop(),r.fire("home"),r.fire("money.earn",e)}):this.summaryWeight()>this.weight()&&(o.dialog({message:r.strings.jobWrongWeight(),title:r.strings.jobTitle()}),i("job").stop(),r.fire("home"))},this.test=function(){this.init().start().show()}}var u=60,a="components/job/",f={x:114,y:64},l={x:0,y:64},c={width:273,height:511},h=20,p=[{weight:25,header:"25",width:15,size:128,img:"25kg"},{weight:20,header:"20",width:12,size:119,img:"20kg"},{weight:15,header:"15",width:11,size:99,img:"15kg"},{weight:10,header:"10",width:10,size:90,img:"10kg"},{weight:5,header:"5",width:12,size:76,img:"5kg"},{weight:2.5,header:"2.5",width:10,size:66,img:"2500g"},{weight:1.25,header:"1.25",width:5,size:49,img:"1250g"},{weight:.625,header:"0.625",width:4,size:41,img:"625g"}],d=[0,1,2,3,4,5,6,7];return r.add(g,n,"job")}),define("text!cs/gyms/view.html",[],function(){return'<div class="gyms">\r\n\r\n    <!-- ko with: selectedGym() -->\r\n\r\n    <div class="meta text-center">\r\n        <h3 data-bind="text:name"></h3>\r\n\r\n        <p data-bind="text:desc"></p>\r\n        <button type="button" class="btn btn-primary" aria-label="Left Align"\r\n                data-bind="attr: {disabled:disabled}, click: $parent.select,\r\n        css:{\'btn-primary\':!disabled,\'btn-danger\':disabled}">\r\n            <span class="glyphicon glyphicon-log-in" aria-hidden="true"></span>\r\n            <span data-bind="text: $parent.strings.gymsBtnEnter"></span>\r\n        </button>\r\n    </div>\r\n\r\n    <button class="btn btn-primary left"\r\n            data-bind="click: $parent.prev, css: { disabled: !$parent.prevEnabled() }">\r\n        <span class="glyphicon glyphicon-chevron-left"></span></button>\r\n    <button class="btn btn-primary right"\r\n            data-bind="click: $parent.next, css: { disabled: !$parent.nextEnabled() }">\r\n        <span class="glyphicon glyphicon-chevron-right"></span></button>\r\n\r\n    <img alt="" src="" data-bind="attr:{src:img,alt:name}"/>\r\n\r\n    <!-- /ko -->\r\n\r\n</div>'}),define("cs/gyms/vm",["ko","text!./view.html","c","model/refs"],function(e,t,n,r){function i(){var t=this;this.strings=n.strings,this.selectedGym=e.observable(null),this.gyms=e.observableArray(),this.update=function(){var e=r.getGyms();return this.gyms(e),this.selectedGym(e[0]),t},this.select=function(){var e=t.gyms().indexOf(this);n.fire("gyms.select",e)},this.getIndex=function(){return t.gyms().indexOf(t.selectedGym())},this.nextEnabled=e.computed(function(){return t.gyms().indexOf(t.selectedGym())<t.gyms().length-1},this),this.prevEnabled=e.computed(function(){return t.gyms().indexOf(t.selectedGym())>0},this),this.next=function(){var e=t.gyms()[t.getIndex()+1];t.selectedGym(e)},this.prev=function(){var e=t.gyms()[t.getIndex()-1];t.selectedGym(e)},this.test=function(){this.init().update().show()}}return n.add(i,t,"gyms")}),define("text!cs/workout/view.html",[],function(){return'<div class="workout">\r\n    <div class="exSelect text-center well">\r\n        <button type="button" class="btn btn-primary left" data-bind="click:prev,css:{disabled:!left()}">\r\n            <span class="glyphicon glyphicon-chevron-left"></span>\r\n        </button>\r\n        <ul class="nav nav-pills" data-bind="foreach: exercises">\r\n            <li role="presentation" data-bind="css: {active:active, disabled:disabled}, click: $parent.select">\r\n                <a href="#" class="text-center">\r\n                    <img alt="..." src="" data-bind="attr:{src:img}" class="img-thumbnail"/>\r\n\r\n                    <div class="caption">\r\n                        <h5 data-bind="text:name"></h5>\r\n                    </div>\r\n                </a>\r\n            </li>\r\n        </ul>\r\n        <button type="button" class="btn btn-primary right" data-bind="click:next,css:{disabled:!right()}">\r\n            <span class="glyphicon glyphicon-chevron-right"></span>\r\n        </button>\r\n    </div>\r\n    <div class="exSetup text-center well" data-bind="visible:selectedExercise">\r\n        <div class="row">\r\n            <div class="col-md-6" data-bind="with:selectedExercise">\r\n                <h2 data-bind="text:name"></h2>\r\n\r\n                <p data-bind="text:desc"></p>\r\n                <buy params="name: \'workout\'"></buy>\r\n            </div>\r\n            <div class="col-md-6" style="padding-top: 15px;">\r\n                <wr params="name:\'workout\'"></wr>\r\n                <pr params="name:\'workout\'"></pr>\r\n            </div>\r\n        </div>\r\n        <div class="row" data-bind="visible:(selectedExercise() ? !selectedExercise().disabled : true)">\r\n            <div class="col-md-6 text-center">\r\n                <h4>\r\n                    <span class="label label-default" data-bind="text:strings.trChooseWeight"></span>\r\n                    <span class="label label-warning" data-bind="text:weightDesc"></span>\r\n                    <span class="label label-primary" data-bind="text:strings.prMini, attr: {title:strings.prDesc}, visible: (selectedExercise()? selectedExercise().pr : 0) < weight()"\r\n                          data-toggle="tooltip" data-placement="bottom" data-delay="500"></span>\r\n                    <span class="label label-danger" data-bind="text:strings.wrMini, attr: {title:strings.wrDesc}, , visible: (selectedExercise()? (selectedExercise().wr ? selectedExercise().wr.value : 0) : 0) < weight()"\r\n                          data-toggle="tooltip" data-placement="bottom" data-delay="500"></span>\r\n                </h4>\r\n                <input class="weightSlider" data-slider-id=\'weightSlider\' type="text" data-slider-tooltip="hide"/>\r\n            </div>\r\n            <div class="col-md-6 text-center">\r\n                <h4>\r\n                    <span class="label label-default" data-bind="text: strings.trChooseRepeats"></span>\r\n                    <span class="label label-warning" data-bind="text:repeatsDesc"></span>\r\n                </h4>\r\n                <input class="repeatsSlider" data-slider-id=\'repeatsSlider\' type="text" data-slider-tooltip="hide"/>\r\n            </div>\r\n            <button class="btn btn-success executeBtn"\r\n                    data-bind="click:execute, attr: { disabled: disabled }">\r\n                <span data-bind="text: strings.trExecute"></span>\r\n                <energy params="name:\'workout\'"></energy>\r\n            </button>\r\n        </div>\r\n    </div>\r\n    <!-- ko if: selectedExercise -->\r\n    <div class="exExecute well text-center" data-bind="visible:selectedExercise">\r\n        <execute params="name:\'workout\'"></execute>\r\n        <journal params="name:\'workout\'"></journal>\r\n    </div>\r\n    <!-- /ko -->\r\n</div>'}),define("text!cs/execute/view.html",[],function(){return'<div class="execute">\r\n    <div class="progress">\r\n        <div class="progress-bar progress-bar-striped active" role="progressbar"\r\n             aria-valuemin="0" aria-valuemax="10"\r\n             data-bind="attr:{\'aria-valuenow\':percent},style:{width:percent()+\'%\'},css:{\'progress-bar-success\':isSuccess,\'progress-bar-warning\':isWarning,\'progress-bar-danger\':isDanger}">\r\n        </div>\r\n    </div>\r\n    <input type="text" class="textvalue form-control text-center" disabled data-bind="value:repeats"/>\r\n</div>'}),define("cs/execute/vm",["ko","text!./view.html","c"],function(e,t,n){function r(e,t){i=[];var n=t*u/3,r=n*2,s,o=Math.min(e,t),a;for(var f=0;f<o*u;f++)f<n?a=3:f<r?a=2:a=1,f%u===0&&(s=[],i.push(s)),s.push(a)}function a(){var t=this;this.repeats=e.observable(0),this.percent=e.observable(30),this.isSuccess=e.observable(!1),this.isWarning=e.observable(!1),this.isDanger=e.observable(!1),this.start=function(e,n){return r(e,n),this.repeats(0),this.percent(0),this.isSuccess(!1),this.isWarning(!1),this.isDanger(!1),s=0,o=0,this.execute(),t},this.getDelay=function(e){return e===3?(this.isSuccess(!0),this.isWarning(!1),this.isDanger(!1),10):e===2?(this.isSuccess(!1),this.isWarning(!0),this.isDanger(!1),20):(this.isSuccess(!1),this.isWarning(!1),this.isDanger(!0),30)},this.execute=function(){var e=i[s];if(!e){n.fire("execute.finished");return}var r=e[o];if(!r){n.fire("execute.finished");return}t.percent((o+1)*2);var a=t.getDelay(r);o++,o===u&&(o=0,s++,t.repeats(s)),setTimeout(t.execute,a)},this.test=function(){n.on("execute.finished",function(){console.log("finished")}),this.init().start(1,1).show()}}var i,s=0,o=0,u=50;return n.add(a,t,"execute")}),define("text!cs/journal/view.html",[],function(){return'<div class="journal text-center">\r\n    <h3 data-bind="text: strings.journalHeader"></h3>\r\n    <table data-bind="foreach: journal">\r\n        <tr>\r\n            <td class="text-right"><b data-bind="text: name"></b></td>\r\n            <td>:&nbsp</td>\r\n            <td class="text-left" data-bind="text: approaches"></td>\r\n        </tr>\r\n    </table>\r\n</div>'}),define("cs/journal/vm",["ko","jquery","text!./view.html","c","model/refs"],function(e,t,n,r,i){function s(){this.strings=r.strings,this.journal=e.observableArray(),this.init=function(){return this.model([]),this.update(),this},this.update=function(){if(!this.model())return[];var e={};t.each(this.model(),function(t,n){e[n.exerciseId]||(e[n.exerciseId]=[]),e[n.exerciseId].push(n)});var n=[];t.each(e,function(e,s){var o={name:i.getExercise(e).name,approaches:t.map(s,function(e){return r.format("{0}x{1}",e.weight,e.repeats)}).join(",")};n.push(o)}),this.journal(n)},this.push=function(e){this.model().push(e),this.update()},this.test=function(){this.init().show(),this.push({exerciseId:0,weight:70,repeats:10})}}return r.add(s,n,"journal")}),define("text!cs/wr/view.html",[],function(){return'<div class="wr">\r\n    <span class="label label-danger" data-bind="text: strings.wrMini, attr: {title:strings.wr}"\r\n          data-toggle="tooltip" data-placement="bottom" data-delay="500"></span>\r\n    <!-- ko if: model() -->\r\n    <span data-bind="text: model().value"></span>\r\n    <span data-bind="text: strings.trMeasureWeight"></span>\r\n    <a data-bind="text: model().player.public.name, click:click"></a>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: !model() -->\r\n    <span data-bind="text: strings.wrNone"></span>\r\n    <!-- /ko -->\r\n\r\n</div>'}),define("cs/wr/vm",["ko","text!./view.html","c","model/player"],function(e,t,n,r){function i(){var e=this;this.strings=n.strings,this.set=function(t){if(!t)return this.model(t),e;var n=new r(t._id);return n.load().then(function(){t.player=n,e.model(t)}),e},this.click=function(){n.fire("player.click",e.model()._id)},this.test=function(){this.init().set({value:215,_id:5653333}).show()}}return n.add(i,t,"wr")}),define("text!cs/pr/view.html",[],function(){return'<div class="pr">\r\n\r\n    <span class="label label-primary" data-bind="text: strings.prMini, attr: {title:strings.pr}"\r\n          data-toggle="tooltip" data-placement="bottom" data-delay="500"></span>\r\n    <!-- ko if: model() -->\r\n    <span data-bind="text: model()"></span>\r\n    <span data-bind="text: strings.trMeasureWeight"></span>\r\n    <!-- /ko -->\r\n\r\n    <!-- ko if: !model() -->\r\n    <span data-bind="text: strings.wrNone"></span>\r\n    <!-- /ko -->\r\n\r\n</div>'}),define("cs/pr/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.strings=n.strings,this.test=function(){this.set(212).show()}}return n.add(r,t,"pr")}),define("text!cs/buy/view.html",[],function(){return'<div class="buy">\r\n    <!-- ko if: model() -->\r\n    <button class="buy-button">\r\n        <span class="glyphicon glyphicon-plus-sign"></span>\r\n        <span data-bind="text: strings.buy"></span>\r\n        <gold params="name:\'buy\'"></gold>\r\n    </button>\r\n    <!-- /ko -->\r\n</div>'}),define("cs/buy/vm",["ko","text!./view.html","c","cs/gold/vm"],function(e,t,n,r){function i(){var e=this;this.strings=n.strings,this.set=function(t){return this.model(t),r("buy").set(t).show(),e},this.test=function(){this.init().set(3).show()}}return n.add(i,t,"buy")}),define("text!cs/energy/view.html",[],function(){return'<div class="energy label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-flash"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("cs/energy/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.bankEnergy,this.click=function(){n.fire("energy.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(15)}}return n.add(r,t,"energy")}),define("cs/workout/vm",["ko","text!./view.html","c","server/server","slider","cs/execute/vm","cs/journal/vm","cs/wr/vm","cs/pr/vm","cs/buy/vm","cs/energy/vm","model/refs"],function(e,t,n,r,i,s,o,u,a,f,l,c){function w(){var t=this;this.strings=n.strings,this.disabled=e.observable(!1),this.exercises=e.observableArray(),this.selectedExercise=e.observable(null),this.left=e.observable(!1),this.right=e.observable(!1),this.weightDesc=e.observable(""),this.weight=e.observable(),this.repeatsDesc=e.observable(""),this.setVisibleExercises=function(){var e=[];for(var t=d;t<h.length&&t<d+p;t++)h[t].active(!1),e.push(h[t]);this.exercises(e),this.left(d>0),this.right(d+p<h.length)},this.onLoad=function(e){y=e.find(".weightSlider").slider({formatter:function(e){return v=e,t.weight(e.toFixed(1)),t.weightDesc(e.toFixed(1)+" "+n.strings.trMeasureWeight()),"Current value: "+e}}),b=e.find(".repeatsSlider").slider({formatter:function(e){return m=e,t.repeatsDesc(e===0?n.strings.trNoLimit():e),"Current value: "+e}})},this.init=function(){return o("workout").init().show(),u("workout").init().show(),a("workout").init().show(),f("workout").init().show(),l("workout").init().show(),s("workout").init(),n.on("execute.finished",function(){t.disabled(!1),o("workout").push(t.approach),n.fire("energy.decrease",t.approach.result.energy),t.approach.result.record&&n.fire("record",t.approach),t.set(t.approach.gymId);var e=$.grep(h,function(e){return e._id===t.approach.exerciseId})[0];t.select(e)}),t},this.set=function(t){var n=c.getExercises(t);g=t;var r=this;return n.forEach(function(t){t.active=e.observable(!1)}),n[0].active(!0),h=n,this.setVisibleExercises(0),r},this.prev=function(){d--,this.setVisibleExercises()},this.next=function(){d++,this.setVisibleExercises()},this.select=function(e){e=e||this,h.forEach(function(e){e.active(!1)}),e.active(!0),y.slider("setAttribute","max",e.max),y.slider("setAttribute","min",e.min),y.slider("setAttribute","step",e.step),y.slider("setValue",e.min),b.slider("setAttribute","max",30),b.slider("setAttribute","min",0),b.slider("setAttribute","step",1),b.slider("setValue",10),t.selectedExercise(e),u("workout").set(e.wr),a("workout").set(e.pr),e.disabled&&f("workout").set(e.cost),f("workout")[e.disabled?"show":"hide"](),l("workout").set(e.energy)},this.execute=function(){var e={gymId:g,exerciseId:this.selectedExercise()._id,weight:v,repeats:m};this.approach=e,r.gymExecute(e).then(function(e){t.approach.result=e,t.disabled(!0),s("workout").start(e.repeats,e.repeatsMax).show()})},this.test=function(){this.init().set(1).show()}}var h,p=3,d=0,v=0,m=0,g,y=null,b=null;return n.add(w,t,"workout")}),define("text!cs/top/view.html",[],function(){return'<div class="top">\r\n    <div class="text-center" data-bind="foreach: visibleMembers">\r\n        <member params="name: \'top\' + $index(), model: $data"></member>\r\n    </div>\r\n    <sw params="name: \'top\'"></sw>\r\n    <span class="top-players" data-bind="text: strings.topPlayers"></span>\r\n    <span class="top-friends" data-bind="text: strings.topFriends"></span>\r\n    <button class="btn btn-primary left"\r\n            data-bind="click: $parent.prev, css: { disabled: !prevEnabled() }">\r\n        <span class="glyphicon glyphicon-chevron-left"></span></button>\r\n    <button class="btn btn-primary right"\r\n            data-bind="click: $parent.next, css: { disabled: !nextEnabled() }">\r\n        <span class="glyphicon glyphicon-chevron-right"></span></button>\r\n</div>'}),define("text!cs/member/view.html",[],function(){return'<div class="member" data-bind="click: click, event: { mouseover: function() { hover($data); }, mouseout: out }">\r\n    <!-- ko if: model -->\r\n    <img class="ava" src="" data-bind="attr: { src: model().public.img, title: model().public.name }"\r\n         data-toggle="tooltip" data-placement="bottom"/>\r\n    <!-- /ko -->\r\n</div>'}),define("cs/member/vm",["ko","text!./view.html","c","social/social"],function(e,t,n,r){function i(){var e=this;this.set=function(t){return t._id===-1&&(t.public.img=r.getUnknowImg()),this.model(t),e},this.click=function(){if(e.model()._id==-1){r.invite();return}n.fire("player.click",e.model()._id)},this.onLoad=function(e){},this.test=function(){require(["model/game"],function(t){e.init().set(t.player).show()})},this.hover=function(e){},this.out=function(){}}return n.add(i,t,"member")}),define("cs/top/vm",["ko","jquery","text!./view.html","c","cs/member/vm","model/game","model/player","server/server","social/social","cs/sw/vm"],function(e,t,n,r,i,s,o,u,a,f){function c(e,t){return t.public.level-e.public.level}function h(e){var t=[];return e.forEach(function(e){t.push(e.id||e._id)}),t}function p(e,n){return t.each(e,function(e,r){var i=t.grep(n,function(e){return r._id==e.id})[0];t.extend(r.public,i)}),e}function d(){return u.loadTop().then(function(e){return e.length==0?[]:t.Deferred(function(t){a.getPlayers(h(e)).then(function(n){e=p(e,n),t.resolve(e)})})})}function v(){return a.getFriends().then(function(e){return e.length===0?[]:t.Deferred(function(t){u.loadPlayers(h(e)).then(function(n){n=p(n,e),t.resolve(n)})})})}function g(){var t=this;this.strings=r.strings,this.myself=null,this.visibleMembers=e.observableArray(),this.page=e.observable(0),this.members=e.observableArray(),this.init=function(){return f("top").init().show(),r.on("sw.switch",function(e){if(e.name!=="sw+top")return;var n=e.state;n?t.toFriendsTop():t.toAllTop()}),t.myself=s.player,t},this.setVisibleMembers=function(e){m==="friends"&&(e=[this.myself].concat(e)),e.sort(c),e.forEach(function(e,t){e.place=m==="top"?t:undefined}),this.members(e);var t=[];for(var n=this.page()*l,r=0;n<e.length&&r<l;n++,r++)t.push(e[n]);for(;n<l;n++)t.push(o(-1));this.visibleMembers([]),this.visibleMembers(t)},this.toAllTop=function(){m="top",this.getMembers(d)},this.toFriendsTop=function(){m="friends",this.getMembers(v)},this.getMembers=function(e){var t=this;e().then(function(e){t.setVisibleMembers(e)})},this.nextEnabled=e.computed(function(){return t.page()<Math.floor(t.members()/l)},this),this.prevEnabled=e.computed(function(){return t.page()>0},this),this.next=function(){t.page(t.page()+1),t.setVisibleMembers(t.members())},this.prev=function(){this.page(this.page()-1),t.setVisibleMembers(t.members())},this.test=function(){this.init().show().toAllTop()}}var l=9,m;return r.add(g,n,"top")}),define("text!cs/achievements/view.html",[],function(){return'<div class="achievements">\r\n    <ul data-bind="foreach: model">\r\n        <li data-bind="css: { completed: completed }">\r\n            <span class="glyphicon glyphicon-unchecked"></span>\r\n            <span class="glyphicon glyphicon-check"></span>\r\n            <h5 data-bind="text: name"></h5>\r\n            <span data-bind="text: desc"></span>\r\n        </li>\r\n    </ul>\r\n</div>'}),define("cs/achievements/vm",["ko","jquery","text!./view.html","c","model/refs"],function(e,t,n,r,i){function s(){var e=this;this.strings=r.strings,this.init=function(){return r.on("achievements.update",function(){e.update()}),e},this.update=function(){return this.model(i.getAchievements()),e},this.test=function(){this.init().update().show()}}return r.add(s,n,"achievements")}),define("cs/main/vm",["ko","jquery","text!./view.html","c","model/game","model/player","cs/private/vm","cs/menu/vm","cs/man/vm","cs/job/vm","cs/gyms/vm","cs/workout/vm","cs/top/vm","cs/achievements/vm"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function v(e){t.each(d,function(t,n){n===e?(n("main").show(),n("main").start&&n("main").start(),n("main").update&&n("main").update()):n("main").hide()})}function m(){var e=this;this.init=function(){return o("main").init().show(),u("main").init().show(),a("main").init(),l("main").init(),p("main").init(),h("main").init().show(),c("main").init(),r.on("gyms.select",function(e){l("main").hide(),c("main").set(e).show()}),r.on("menu.select",function(e){e===0&&a("main").set(i.player),v(d[e])}),r.on("player.click",function(e){if(i.player._id!==e){var t=new s(e);t.load().then(function(){a("main").set(t),v(a),u("main").selectByIndex(-1)})}else u("main").selectByIndex(0)}),e},this.set=function(t){return o("main").set(t),a("main").set(t),h("main").toAllTop(),v(a),e},this.test=function(){this.init().set(i.player).show()},r.on("home",function(){u("main").selectByIndex(0)})}var d=[a,f,l,p,c,c];return r.add(m,n,"main")}),window.cfg={debug:!0,payments:!0,publish:!0,server:"http://localhost:8080/",language:"ru"},requirejs.config({shim:{fb:{exports:"FB"},bootstrap:{deps:["jquery"]},bootbox:{deps:["bootstrap"]}},paths:{ko:"//cdnjs.cloudflare.com/ajax/libs/knockout/3.3.0/knockout-debug",howler:"//cdnjs.cloudflare.com/ajax/libs/howler/1.1.17/howler.min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min",bootstrap:"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min",bootbox:"//cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.3.0/bootbox.min",toastr:"//cdnjs.cloudflare.com/ajax/libs/toastr.js/2.1.1/toastr.min",slider:"//cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/4.14.4/bootstrap-slider.min",vk:"//vk.com/js/api/xd_connection",fb:"//connect.facebook.net/en_US/all",text:"lib/ko/text",c:"plugins/component",cs:"components/"}}),require(["ko","jquery","text","bootstrap","social/social","social/demo","server/server","server/heroku","model/game","plugins/dynamic-tooltips","plugins/prevent-selection","plugins/ko-hack"],function(e,t,n,r,i,s,o,u,a){var f=5653333,l=123;t.when.apply(t,[i.init(s),o.init(u,f,l)]).then(function(){return a.init()},function(e){window.stopSpinner(),a.error(e)}).then(function(){var t=window.location.search,n=t.length>0?t.substring(1):null;window.cfg.debug===!0&&n?require(["cs/"+n+"/vm"],function(t){window.stopSpinner(),e.applyBindings({}),t().test()}):require(["cs/main/vm"],function(t){window.stopSpinner(),e.applyBindings({}),t().test()})})}),define("main",function(){}),define("text!components/ava/view.html",[],function(){return'<div class="ava" data-bind="click:click">\r\n    <!-- ko if: model() -->\r\n    <img class="avatar" alt="" src="" data-bind="attr: { src: model().public.img }"/>\r\n    <img class="frame" alt="" src="components/ava/frame.png" data-bind="attr: { title: model() ? model().public.name : \'\' }"\r\n         data-toggle="tooltip" data-placement="left"/>\r\n    <!-- /ko -->\r\n</div>'}),define("components/ava/vm",["ko","text!./view.html","c","social/social"],function(e,t,n,r){function i(){this.click=function(){if(this.model().private){n.fire("player.click",this.model()._id);return}if(this.model()._id==0){r.invite();return}var e=r.getUserUrl(this.model()._id),t=window.open(e,"_blank");t.focus()},this.onLoaded=function(e){setTimeout(function(){e.find("img.frame").tooltip()},1e3)},this.test=function(){var e=this;require(["model/game"],function(t){e.init().set(t.player).show()})}}return n.add(i,t,"ava")}),define("text!components/battery/view.html",[],function(){return'<div class="battery" data-bind="click:click,attr:{\'title\':title}"\r\n           data-toggle="tooltip" data-placement="bottom">\r\n    <!-- ko if: value != undefined -->\r\n    <div class="progress">\r\n        <div class="progress-bar" role="progressbar"\r\n             aria-valuemin="0"\r\n             data-bind="attr:{\'aria-valuenow\':value,\'aria-valuemax\':max},style:{width:percent()},\r\ncss:{\'progress-bar-success\':yellow() <= value(),\'progress-bar-warning\':red() <= value() && value() < yellow(),\'progress-bar-danger\':value() < red()}">\r\n        </div>\r\n    </div>\r\n    <div class="value text-center" data-bind="text: valueDesc"></div>\r\n    <!-- /ko -->\r\n</div>'}),define("components/battery/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){var t=this;this.red=e.observable(),this.yellow=e.observable(),this.title=n.strings.bankEnergy,this.value=null,this.set=function(n,r,i){return this.max=n,this.value=r,this.percent=e.computed(function(){return this.value()/this.max()*100+"%"},this),this.red=e.computed(function(){return this.max()*.33},this),this.yellow=e.computed(function(){return this.max()*.66},this),this.valueDesc=e.computed(function(){return i==="%"?this.value()/this.max()*100+"%":this.value()+"/"+this.max()},this),t},this.click=function(){n.fire("energy.add")},this.test=function(){function i(){n(r),r<t()&&window.setTimeout(i,20),r++}var t=e.observable(155),n=e.observable(115);this.init().set(t,n).show();var r=0;window.setTimeout(i,1e3)}}return n.add(r,t,"battery")}),define("text!components/friends/view.html",[],function(){return'<div class="friends label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-user"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("components/friends/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.socialFriends,this.click=function(){n.fire("friends.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(5)}}return n.add(r,t,"friends")}),define("text!components/gold/view.html",[],function(){return'<div class="gold label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-certificate"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("components/gold/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.bankGold,this.click=function(){n.fire("gold.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(15)}}return n.add(r,t,"gold")}),define("text!components/main/view.html",[],function(){return'<div class="main">\r\n    <private params="name: \'main\'"></private>\r\n    <menu params="name: \'main\'"></menu>\r\n    <div class="menu-container">\r\n        <man params="name: \'main\'"></man>\r\n        <job params="name: \'main\'"></job>\r\n        <gyms params="name: \'main\'"></gyms>\r\n        <workout params="name: \'main\'"></workout>\r\n        <achievements params="name: \'main\'"></achievements>\r\n    </div>\r\n    <top params="name: \'main\'"></top>\r\n</div>'}),define("components/main/vm",["ko","jquery","text!./view.html","c","model/game","model/player","cs/private/vm","cs/menu/vm","cs/man/vm","cs/job/vm","cs/gyms/vm","cs/workout/vm","cs/top/vm","cs/achievements/vm"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function v(e){t.each(d,function(t,n){n===e?(n("main").show(),n("main").start&&n("main").start(),n("main").update&&n("main").update()):n("main").hide()})}function m(){var e=this;this.init=function(){return o("main").init().show(),u("main").init().show(),a("main").init(),l("main").init(),p("main").init(),h("main").init().show(),c("main").init(),r.on("gyms.select",function(e){l("main").hide(),c("main").set(e).show()}),r.on("menu.select",function(e){e===0&&a("main").set(i.player),v(d[e])}),r.on("player.click",function(e){if(i.player._id!==e){var t=new s(e);t.load().then(function(){a("main").set(t),v(a),u("main").selectByIndex(-1)})}else u("main").selectByIndex(0)}),e},this.set=function(t){return o("main").set(t),a("main").set(t),h("main").toAllTop(),v(a),e},this.test=function(){this.init().set(i.player).show()},r.on("home",function(){u("main").selectByIndex(0)})}var d=[a,f,l,p,c,c];return r.add(m,n,"main")}),define("text!components/sw/view.html",[],function(){return'<div class="sw text-center">\r\n    <input type="checkbox"/>\r\n    <label class="attention" data-bind="event: { mousedown: click }">\r\n        <i></i>\r\n    </label>\r\n</div>'}),define("components/sw/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){var e=this;this.state=!1,this.click=function(t){$(t.click.arguments[1].currentTarget).prev("input").click(),e.state=!e.state,n.fire("sw.switch",{name:e.name,state:e.state})},this.test=function(){n.on("sw.switch",function(e){console.log(e)}),this.init().show()}}return n.add(r,t,"sw")}),define("text!components/man/view.html",[],function(){return'<div class="man">\r\n\r\n    <img class="img-back" src="components/gyms/gym0.jpg"/>\r\n\r\n    <div class="shadow"></div>\r\n\r\n    <!-- ko if: model() -->\r\n\r\n    <map name="navigation" data-bind="foreach: muscles">\r\n        <area data-bind="attr: { coords: map, \'data-id\': $index }"\r\n              shape="poly"\r\n              href="javascript:;">\r\n    </map>\r\n\r\n    <img class="img-body" alt="" src="" data-bind="attr: { src: src }"/>\r\n\r\n    <muscleinfo params="name: \'man\'"></muscleinfo>\r\n\r\n    <img class="img-map" src="components/man/transparent.png" border="0" usemap="#navigation"/>\r\n\r\n    <ava params="name:\'man\'"></ava>\r\n\r\n    <div class="frazzle-map" data-bind="visible: model().private">\r\n        <h5 data-bind="text: strings.showFrazzle"></h5>\r\n        <sw params="name: \'man\'"></sw>\r\n    </div>\r\n\r\n    <!-- /ko -->\r\n\r\n</div>'}),define("components/man/vm",["ko","jquery","text!./view.html","c","social/social","model/refs","model/player","cs/muscleinfo/vm","cs/sw/vm","cs/ava/vm"],function(e,t,n,r,i,s,o,u,a,f){function l(e){e.frazzle$=t('<canvas class="frazzle" width="480px" height="550px"/>'),e.elem$.find("img.img-map").before(e.frazzle$);var n=e.frazzle$[0].getContext("2d");t.each(e.muscles(),function(e,t){var i=t.map.split(",");n.beginPath(),n.moveTo(i[0],i[1]);for(var s=2;s<i.length-1;s+=2)n.lineTo(i[s],i[s+1]);n.closePath(),n.fillStyle=r.format("rgba(255,0,0,{0})",t.frazzle()/2),n.fill()})}function c(e){e.frazzle$.remove()}function h(e,n){e.highlight$=t('<canvas class="highlight" width="480px" height="550px"/>'),e.elem$.find("img.img-map").before(e.highlight$);var r=e.highlight$[0].getContext("2d"),i=n.map.split(",");r.beginPath(),r.moveTo(i[0],i[1]);for(var s=2;s<i.length-1;s+=2)r.lineTo(i[s],i[s+1]);r.closePath(),r.fillStyle="rgba(0,255,0,.4)",r.fill()}function p(e){e.highlight$.remove()}function d(){var n=this;this.strings=r.strings,this.src=e.observable(),this.muscles=e.observableArray(),this.click=function(){if(this.model().id==0){i.invite();return}var e=i.getUserUrl(this.model().id),t=window.open(e,"_blank");t.focus()},this.init=function(){return f("man").init(),a("man").init(),u("man").init(),r.on("sw.switch",function(e){if(e.name!=="sw+man")return;e.state?l(n):c(n)}),n},this.set=function(e){return this.model(e),this.src(r.format("components/man/{0}.png",e.public.level())),this.muscles(s.getMuscles(!!e.private)),e.private?(f("man").hide(),a("man").show()):f("man").set(e).show(),n},this.onLoad=function(e){e.on("mouseenter","area",function(e){var r=t(e.currentTarget).data("id"),i=n.muscles()[r];h(n,i)}),e.on("mousemove","area",function(e){var r=t(e.currentTarget).data("id"),i=n.muscles()[r],s=n.elem$.offset();i.x1=e.clientX-s.left,i.y1=e.clientY-s.top,u("man").set(i).show()}),e.on("mouseleave","area",function(){u("man").hide(),p(n)}),this.elem$=e},this.test=function(){require(["model/game"],function(e){n.init().set(e.player).show()})}}return r.add(d,n,"man")}),define("text!components/member/view.html",[],function(){return'<div class="member" data-bind="click: click, event: { mouseover: function() { hover($data); }, mouseout: out }">\r\n    <!-- ko if: model -->\r\n    <img class="ava" src="" data-bind="attr: { src: model().public.img, title: model().public.name }"\r\n         data-toggle="tooltip" data-placement="bottom"/>\r\n    <!-- /ko -->\r\n</div>'}),define("components/member/vm",["ko","text!./view.html","c","social/social"],function(e,t,n,r){function i(){var e=this;this.set=function(t){return t._id===-1&&(t.public.img=r.getUnknowImg()),this.model(t),e},this.click=function(){if(e.model()._id==-1){r.invite();return}n.fire("player.click",e.model()._id)},this.onLoad=function(e){},this.test=function(){require(["model/game"],function(t){e.init().set(t.player).show()})},this.hover=function(e){},this.out=function(){}}return n.add(i,t,"member")}),define("text!components/menu/view.html",[],function(){return'<div class="menu">\r\n    <ul class="nav nav-pills" data-bind="foreach: items">\r\n        <li role="presentation" data-bind="css: {active:active}, click: $parent.select">\r\n            <a href="#" data-bind="text:name"></a>\r\n        </li>\r\n    </ul>\r\n</div>'}),define("components/menu/vm",["ko","text!./view.html","c"],function(e,t,n){function s(){var t=this;this.items=e.observableArray(i),this.selectByIndex=function(e){i.forEach(function(e){e.active(!1)}),e>=0&&(i[e].active(!0),n.fire("menu.select",e))},this.select=function(){var e=t.items().indexOf(this);t.selectByIndex(e)},this.test=function(){n.on("menu.select",function(e){console.log("Selected item is "+e)}),this.init().show()}}var r=n.strings,i=[{name:r.menuHome,active:e.observable(!0)},{name:r.menuJob,active:e.observable(!1)},{name:r.menuWorkout,active:e.observable(!1)},{name:r.menuAchievements,active:e.observable(!1)},{name:r.menuShop,active:e.observable(!1)}];return n.add(s,t,"menu")}),define("text!components/money/view.html",[],function(){return'<div class="money label label-primary" data-bind="click:click,attr:{\'title\':title}"\r\n     data-toggle="tooltip" data-placement="right" data-delay="500">\r\n    <span class="glyphicon glyphicon-usd" aria-hidden="true"></span>\r\n    <span data-bind="text: model()"></span>\r\n</div>'}),define("components/money/vm",["ko","text!./view.html","c"],function(e,t,n){function r(){this.title=n.strings.bankMoney,this.click=function(){n.fire("money.add")},this.test=function(){var t=e.observable(10);this.init().set(t).show(),t(200)}}return n.add(r,t,"money")}),define("text!components/muscleinfo/view.html",[],function(){return'<div class="muscleinfo">\r\n    <!-- ko if: model -->\r\n    <div class="info">\r\n        <h4 data-bind="text: strings[\'manM\' + model()._id]"></h4>\r\n        <battery params="name: \'muscleinfo\'"></battery>\r\n    </div>\r\n    <svg>\r\n        <line x2="500" y2="70" stroke-width="1" stroke="rgba(255, 255, 255, 0.37)" data-bind="attr: { x1: model().x1, y1: model().y1 }"/>\r\n        <circle r="2" fill="rgba(255, 255, 255, 0.37)" data-bind="attr: { cx: model().x1, cy: model().y1 }"/>\r\n        <circle cx="500" cy="70" r="2" fill="rgba(255, 255, 255, 0.37)"/>\r\n    </svg>\r\n    <!-- /ko -->\r\n</div>'}),define("components/muscleinfo/vm",["ko","jquery","text!./view.html","c","cs/battery/vm"],function(e,t,n,r,i){function s(){var n=this;this.strings=r.strings,this.init=function(){return i("muscleinfo").init().show(),n},this.set=function(t){this.model(t);if(t.frazzle){var r=i("muscleinfo"),s=Math.floor(100-t.frazzle()*100);if(!r.value){var o=e.observable(100),u=e.observable(s);r.set(o,u,"%")}else r.value(s)}return n},this.test=function(){var n={_id:3,frazzle:e.observable(.5),stress:e.observable(.2),x1:50,y1:50};this.init().set(n).show(),t("body").css("background-color","black")}}return r.add(s,n,"muscleinfo")}),define("text!components/private/view.html",[],function(){return'<div class="private">\r\n    <img src="components/private/logo.png"/>\r\n    <div class="bricks"></div>\r\n    <div class="info info-ava">\r\n        <ava params="name: \'private\'"></ava>\r\n        <battery params="name: \'private\'"></battery>\r\n    </div>\r\n    <div class="info info-money">\r\n        <money params="name: \'private\'"></money>\r\n        <mass params="name: \'private\'"></mass>\r\n        <friends params="name: \'private\'"></friends>\r\n        <gold params="name: \'private\'"></gold>\r\n    </div>\r\n</div>'}),define("components/private/vm",["ko","text!./view.html","c","cs/ava/vm","cs/battery/vm","cs/mass/vm","cs/money/vm","cs/gold/vm","cs/friends/vm"],function(e,t,n,r,i,s,o,u,a){function f(){var e=this;this.init=function(){return r("private").init().show(),i("private").init().show(),s("private").init().show(),o("private").init().show(),u("private").init().show(),a("private").init().show(),a("private").init().show(),e},this.set=function(t){return r("private").set(t),i("private").set(t.private.energyMax,t.private.energy),s("private").set(t.public.mass),o("private").set(t.private.money),u("private").set(t.private.gold),a("private").set(t.private.friends),e},this.test=function(){require(["model/game"],function(t){e.init().set(t.player).show()})}}return n.add(f,t,"private")}),define("text!components/top/view.html",[],function(){return'<div class="top">\r\n    <div class="text-center" data-bind="foreach: visibleMembers">\r\n        <member params="name: \'top\' + $index(), model: $data"></member>\r\n    </div>\r\n    <sw params="name: \'top\'"></sw>\r\n    <span class="top-players" data-bind="text: strings.topPlayers"></span>\r\n    <span class="top-friends" data-bind="text: strings.topFriends"></span>\r\n    <button class="btn btn-primary left"\r\n            data-bind="click: $parent.prev, css: { disabled: !prevEnabled() }">\r\n        <span class="glyphicon glyphicon-chevron-left"></span></button>\r\n    <button class="btn btn-primary right"\r\n            data-bind="click: $parent.next, css: { disabled: !nextEnabled() }">\r\n        <span class="glyphicon glyphicon-chevron-right"></span></button>\r\n</div>'}),define("components/top/vm",["ko","jquery","text!./view.html","c","cs/member/vm","model/game","model/player","server/server","social/social","cs/sw/vm"],function(e,t,n,r,i,s,o,u,a,f){function c(e,t){return t.public.level-e.public.level}function h(e){var t=[];return e.forEach(function(e){t.push(e.id||e._id)}),t}function p(e,n){return t.each(e,function(e,r){var i=t.grep(n,function(e){return r._id==e.id})[0];t.extend(r.public,i)}),e}function d(){return u.loadTop().then(function(e){return e.length==0?[]:t.Deferred(function(t){a.getPlayers(h(e)).then(function(n){e=p(e,n),t.resolve(e)})})})}function v(){return a.getFriends().then(function(e){return e.length===0?[]:t.Deferred(function(t){u.loadPlayers(h(e)).then(function(n){n=p(n,e),t.resolve(n)})})})}function g(){var t=this;this.strings=r.strings,this.myself=null,this.visibleMembers=e.observableArray(),this.page=e.observable(0),this.members=e.observableArray(),this.init=function(){return f("top").init().show(),r.on("sw.switch",function(e){if(e.name!=="sw+top")return;var n=e.state;n?t.toFriendsTop():t.toAllTop()}),t.myself=s.player,t},this.setVisibleMembers=function(e){m==="friends"&&(e=[this.myself].concat(e)),e.sort(c),e.forEach(function(e,t){e.place=m==="top"?t:undefined}),this.members(e);var t=[];for(var n=this.page()*l,r=0;n<e.length&&r<l;n++,r++)t.push(e[n]);for(;n<l;n++)t.push(o(-1));this.visibleMembers([]),this.visibleMembers(t)},this.toAllTop=function(){m="top",this.getMembers(d)},this.toFriendsTop=function(){m="friends",this.getMembers(v)},this.getMembers=function(e){var t=this;e().then(function(e){t.setVisibleMembers(e)})},this.nextEnabled=e.computed(function(){return t.page()<Math.floor(t.members()/l)},this),this.prevEnabled=e.computed(function(){return t.page()>0},this),this.next=function(){t.page(t.page()+1),t.setVisibleMembers(t.members())},this.prev=function(){this.page(this.page()-1),t.setVisibleMembers(t.members())},this.test=function(){this.init().show().toAllTop()}}var l=9,m;return r.add(g,n,"top")});