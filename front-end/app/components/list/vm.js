define(["ko","jquery","text!./view.html","plugins/component","c/member/vm","model/game","model/player","server/server","social/social","c/sw/vm"],function(e,t,n,r,i,s,o,u,a,f){function c(e,t){return t.public.level-e.public.level}function h(e){var t=[];return e.forEach(function(e){t.push(e.id||e._id)}),t}function p(e,n){return t.each(e,function(e,r){var i=t.grep(n,function(e){return r._id==e.id})[0];t.extend(r.public,i)}),e}function d(){return u.loadTop().then(function(e){return e.length==0?[]:t.Deferred(function(t){a.getPlayers(h(e)).then(function(n){e=p(e,n),t.resolve(e)})})})}function v(){return a.getFriends().then(function(e){return e.length===0?[]:t.Deferred(function(t){u.loadPlayers(h(e)).then(function(n){n=p(n,e),t.resolve(n)})})})}function g(){var t=this;this.strings=r.strings,this.myself=null,this.visibleMembers=e.observableArray(),this.page=e.observable(0),this.members=e.observableArray(),this.init=function(){return f("top").show().init().progress(function(e){e?t.toFriendsTop():t.toAllTop()}),t.myself=s.player,t},this.setVisibleMembers=function(e){m==="friends"&&(e=[this.myself].concat(e)),e.sort(c),e.forEach(function(e,t){e.place=m==="top"?t:undefined}),this.members(e);var t=[];for(var n=this.page()*l,r=0;n<e.length&&r<l;n++,r++)t.push(e[n]);for(;n<l;n++)t.push(o(-1));this.visibleMembers([]),this.visibleMembers(t)},this.toAllTop=function(){m="top",this.getMembers(d)},this.toFriendsTop=function(){m="friends",this.getMembers(v)},this.getMembers=function(e){var t=this;e().then(function(e){t.setVisibleMembers(e)})},this.nextEnabled=e.computed(function(){return t.page()<Math.floor(t.members()/l)},this),this.prevEnabled=e.computed(function(){return t.page()>0},this),this.next=function(){t.page(t.page()+1),t.setVisibleMembers(t.members())},this.prev=function(){this.page(this.page()-1),t.setVisibleMembers(t.members())},this.test=function(){this.show().init(),this.toAllTop()}}var l=9,m;return r.add(g,n,"list")});