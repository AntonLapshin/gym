define(["ko","text!./view.html","plugins/component","components/timer/vm","bootbox"],function(e,t,n,r,i){function d(e,t){return Math.floor(Math.random()*(t-e+1))+e}function v(e){var t,n=[],r=[],i=0,s=0;for(var o=0;o<p.length;o++)n.push(o);var u=0;while(r.length<p.length&&u<100){var a=d(0,n.length-1);if(n[a]==-1){u++;continue}var f=p[a];if(i+f.size<c.width&&s+f.size<c.height){var l={weight:f.weight,id:a,x:i,y:s,side:e};r.push(l),i+=f.size,n[a]=-1,i+83>c.width&&(i=0,s+=85)}u++}return r}function m(e,t){var n=[];for(var r=0;r<e.length;r++){var i=e[r];if(i.side==t)continue;var s=p[i.id],o={id:i.id,weight:s.weight,header:s.header+" кг",img:a+s.img+".png",x:i.x+"px",y:i.y+"px"};n.push(o)}return n}function g(){this.weight=e.observable(),this.items=e.observableArray([]),this.itemsSelected=e.observableArray([]),this.summaryWeight=e.computed(function(){var e=h;for(var t=0;t<this.itemsSelected().length;t++)e+=this.itemsSelected()[t].weight;return e},this),this.itemsLeft=e.computed(function(){return m(this.items(),"right")},this),this.itemsRight=e.computed(function(){return m(this.items(),"left")},this),this.itemsSideLeft=e.computed(function(){var e=[],t=f.x,n=f.y;for(var r=0;r<this.itemsSelected().length;r++){var i=this.itemsSelected()[r];if(i.side=="right")continue;var s=p[i.id];t-=s.width;var o={header:s.header+" кг",img:a+s.img+"-side.png",x:t+"px",y:Math.floor(n-s.height/2)+"px"};e.push(o)}return e},this),this.itemsSideRight=e.computed(function(){var e=[],t=l.x,n=l.y;for(var r=0;r<this.itemsSelected().length;r++){var i=this.itemsSelected()[r];if(i.side=="left")continue;var s=p[i.id],o={header:s.header+" кг",img:a+s.img+"-side.png",x:t+"px",y:Math.floor(n-s.height/2)+"px"};t+=s.width,e.push(o)}return e},this),this.show=function(e){var t=this;this.itemsSelected([]);var n=v("left"),i=v("right"),o=[],a;for(a=0;a<n.length;a++)o.push(n[a]);for(a=0;a<i.length;a++)o.push(i[a]);return this.items(o),this.weight(e),r("jobbing").show(60).then(function(){s.reject(u.jobTimeIsUp())}),this.isVisible(!0),$.Deferred(function(e){s=e})},this.select=function(e){var t=p[e.id],n=this.itemsSelected(),r=this.items(),i=[];for(var o=0;o<r.length;o++)r[o].weight!=t.weight?i.push(r[o]):n.push(r[o]);this.items(i),this.itemsSelected(n),this.summaryWeight()==this.weight()?s.resolve():this.summaryWeight()>this.weight()&&s.reject(u.jobWrongWeight())},this.test=function(){this.show(105).then(function(){console.log("finished")}).fail(function(e){console.log(e)})}}var s,o,u=n.strings,a="components/jobbing/",f={x:89,y:74},l={x:0,y:74},c={width:195,height:298},h=20,p=[{weight:25,header:"25",width:9,height:83,size:91,img:"25kg"},{weight:20,header:"20",width:8,height:77,size:83,img:"20kg"},{weight:15,header:"15",width:7,height:65,size:72,img:"15kg"},{weight:10,header:"10",width:7,height:60,size:63,img:"10kg"},{weight:5,header:"5",width:7,height:51,size:54,img:"5kg"},{weight:2.5,header:"2.5",width:6,height:41,size:48,img:"2500g"},{weight:1.25,header:"1.25",width:4,height:32,size:36,img:"1250g"},{weight:.625,header:"0.625",width:3,height:27,size:28,img:"625g"}];return n.add(g,t,"jobbing")});